---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
const speakers = await getCollection("speakers");
---

<h1>Nuestros conferencistas</h1>

<div data-featured-speakers class="h-screen flex items-center gap-24">
  {
    speakers.map((sp) => (
      <div
        data-speaker
        class="flex flex-col md:flex-row gap-6 w-full md:w-auto h-5/6 shrink-0"
      >
        <Image
          src={sp.data.picture}
          alt={sp.data.first_name ?? ""}
          class="w-full max-w-lg h-full object-cover rounded-t-full"
        />

        <div class="w-full max-w-lg flex flex-col gap-6">
          <h1>
            {sp.data.title} {sp.data.first_name} {sp.data.last_name}
          </h1>
          {sp.data.bio && <p class="text-justify">{sp.data.bio}</p>}
        </div>
      </div>
    ))
  }
</div>

<script>
  import { gsap, ScrollTrigger } from "gsap/all";
  gsap.registerPlugin(ScrollTrigger);

  const container = document.querySelector("[data-featured-speakers]")!;
  const speakers = container.querySelectorAll("[data-speaker]")!;

  const set_speakers_y = () => {
    speakers.forEach((spk) => {
      const percentage_from_center =
        spk.getBoundingClientRect().left / window.innerWidth - 0.25;

      gsap.set(spk, {
        y:
          ((percentage_from_center / Math.sqrt(1 / percentage_from_center)) *
            window.innerHeight) /
          2,
      });
    });
  };
  set_speakers_y();

  const scroll_distance = 1000;

  gsap.set(container, {
    marginBottom: scroll_distance,
  });

  gsap.to(speakers, {
    scrollTrigger: {
      trigger: container,
      start: "top top",
      end: "bottom top",
      scrub: true,
      pin: true,
      onUpdate: () => {
        set_speakers_y();
      },
    },
    translateX: () => -(container.scrollWidth - container.clientWidth),
  });
</script>
