---
import Schedule from "@/components/Schedule.astro";
import Layout from "@/layouts/Layout.astro";
import { horario } from "@/utils/notion";

const events = await horario();

const grouped_by_day: any = {};
events.results.forEach((event) => {
  const date = new Date(
    (event.properties as any)["Fecha"].date.start,
  ).toLocaleDateString("es-ES", {
    month: "long",
    day: "numeric",
  });

  if (!grouped_by_day[date]) {
    console.log(
      `Event ${(event.properties as any).Name.title[0].plain_text} is the first event on ${(event.properties as any)["Fecha"].date.start}`,
    );
    grouped_by_day[date] = [event];
  } else {
    console.log(
      `Event ${(event.properties as any).Name.title[0].plain_text} is going to be grouped according to ${(event.properties as any)["Fecha"].date.start}`,
    );
    grouped_by_day[date].push(event);
  }
});

console.log({ grouped_by_day });
---

<Layout>
  {
    Object.keys(grouped_by_day).map((date) => {
      return <Schedule title={date} events={grouped_by_day[date]} />;
    })
  }
</Layout>
